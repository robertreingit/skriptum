{"title":"Interaktionseffekte","markdown":{"headingText":"Interaktionseffekte","containsRefs":false,"markdown":"\n```{r}\n#| echo: false\n#| warning: false\n#| message: false\nsource('_common.R')\n```\n\n\n\n```{r defs_mult_reg_inter}\nlm_coef_ex <- function(mod, max_co=3) round(summary(mod)$coefficients[,1:max_co],2)\nn <- 40\nset.seed(123)\nfoo <- MASS::mvrnorm(n, mu = c(184,77),\n              Sigma=matrix(c(72,37,37,125),nr=2))\nhandball <- tibble::tibble(\n  arm_span = foo[,1],\n  body_mass = foo[,2],\n  vel = 1 + 0.12*body_mass + 0.06*arm_span + 0.02*(body_mass-77)*(arm_span-184) + rnorm(n)\n)\n```\n\n## Beispieldaten^[@debanne2011]\n\n```{r}\nhandball |> head() |>\n  knitr::kable(col.names=c('Velocity[m/s]','body mass[kg]','arm span[cm]'),\n               booktabs = TRUE,\n               caption = \"Beispieldaten (synthetisch)\",\n               linesep = \"\",\n               digits = 2,\n               escape = F)\n```\n\n\n## Beispieldaten - Deskriptiv\n\n```{r}\nhandball |> summarytools::descr(\n  stats = c('mean','sd','min','max'), style = 'rmarkdown',\n  transpose = T) |>\n  knitr::kable(booktabs= T,\n               caption = 'Deskriptive Statistik der Handballdaten',\n               linesep = '',\n               digits = 1)\n```\n\n## Beispieldaten\n\n```{r}\n#| fig.cap: \"Geschwindigkeit gegen Körpergewicht\"\n\nggplot(handball, aes(body_mass, vel)) +\n  geom_point(size=3) +\n  labs(x = 'Köpergewicht [kg]', y = 'Geschwindigkeit [m/s]') \n```\n\n```{r}\n#| fig.cap: \"Geschwindigkeit gegen Armspannweite\"\n\nggplot(handball, aes(arm_span, vel)) +\n  geom_point(size=3) +\n  labs(x = 'Armspannweite [cm]', y = 'Geschwindigkeit [m/s]') \n```\n\n## Beispieldaten - Startmodell\n\n$$\nY_{i} = \\beta_0 + \\beta_1 \\times \\textrm{bm}_i + \\beta_2 \\times \\textrm{as}_i + \\epsilon_i\n$$\n```{r, echo=T}\nmod_1 <- lm(vel ~ body_mass + arm_span, handball)\n```\n```{r}\nmod_1 |> lm_tbl_knitr(caption = \"Modell 1\", long = T, add_sigma = T)\n```\n\n## Modellfit\n\n```{r}\n#| fig.cap: \"3D Streudiagramm\"\n\npar(mar=c(1,1,1,1), cex.axis = 0.5)\n# x, y, z variables\nx <- handball$body_mass\ny <- handball$arm_span\nz <- handball$vel\n# Compute the linear regression (z = ax + by + d)\nfit <- lm(z ~ x + y)\n# predict values on regular xy grid\ngrid.lines = 26\nx.pred <- seq(min(x), max(x), length.out = grid.lines)\ny.pred <- seq(min(y), max(y), length.out = grid.lines)\nxy <- expand.grid( x = x.pred, y = y.pred)\nz.pred <- matrix(predict(fit, newdata = xy), \n                 nrow = grid.lines, ncol = grid.lines)\n# fitted points for droplines to surface\nfitpoints <- predict(fit)\n# scatter plot with regression plane\nplot3D::scatter3D(x, y, z, col='black', pch=16, cex=1.2,\n    theta = 20, phi = 20, ticktype = \"detailed\",\n    xlab = \"body mass[kg]\", ylab = \"arm span[cm]\", zlab = \"ball velocity[m/s]\",  \n    surf = list(x = x.pred, y = y.pred, z = z.pred,  \n    facets = NA, fit = fitpoints, col='red'), main = \"\", bty=\"b2\",\n    colkey=F, d = 4)\n```\n\n## Zentrierung\n\n```{r, echo=T}\nhandball <- dplyr::mutate(handball,\n                          body_mass_c = body_mass - mean(body_mass),\n                          arm_span_c = arm_span - mean(arm_span))\n```\n\n```{r}\nhandball |> summarytools::descr(stat = c('mean','sd'),\n                    style=\"rmarkdown\", transpose = T) |> \n  knitr::kable(booktabs=T, digits = 2,\n               caption = 'Deskriptive Statistik')\n```\n\n## Modell mit zentrierten Variablen\n\n```{r, echo=T}\nmod_2 <- lm(vel ~ body_mass_c + arm_span_c, handball)\n```\n```{r}\nmod_2 |> lm_tbl_knitr(caption = \"Modell 2\", long = T, add_sigma = T)\n```\n\n## Residuen im zentrierten, additiven Modell\n\n```{r}\n#| fig.cap=\"Residuenplot\"\n\nhandball <- handball |> \n  dplyr::mutate(res_2 = resid(mod_2),\n                y_hat_2 = predict(mod_2))\np_resid_2 <- ggplot(handball, aes(y_hat_2, res_2)) +\n  geom_point() +\n  geom_hline(yintercept = 0, col = 'red', linetype = 'dashed') +\n  labs(x = expression(paste('Vorhergesagte Werte ', hat(y)[i])),\n       y = expression(paste('Residuen ', hat(e)[i]))) \nprint(p_resid_2)\n```\n\n## Added-variable plot\n\n```{r}\n#| out.width: \"90%\"\n#| label: \"fig-mlm-interaction-avp\"\n#| fig.cap: \"Added-variable Graph mit `car::avPlots()`\"\n\npar(mar=c(3,3,2,1))\ncar::avPlots(mod_2)\n#mtext('body_mass_c | others', 1, line=1.8)\n#mtext('vel | others', 2, line=1.9)\n```\n\n\n## Was passiert wenn die Effekte nicht mehr nur additiv sind?\n\n```{r}\n#| fig.cap: \"Unterteilung von Körpergewicht und Armspannweite in Kategorien\"\n\nhb_quick <- handball |>\n  dplyr::mutate(as_f = cut(arm_span_c, 3),\n         bm_f = cut(body_mass_c, 3)) \n\nhb_quick |>\n  dplyr::group_by(as_f, bm_f) |> \n  dplyr::summarize(m = mean(vel), sd = sd(vel)) |> \n  ggplot(aes(as_f, m, color=bm_f, group=bm_f)) +\n  geom_pointrange(aes(ymin = m - sd, ymax = m + sd)) +\n  geom_line() +\n  labs(x = 'Armspannweite', y = 'Geschwindigkeit') +\n  theme(legend.position = 'bottom')\n```\n\n## Was passiert wenn die Effekte nicht mehr nur additiv sind?\n\n### Neues Modell mit Interaktionen:\n\n\n$$\nY_{i} = \\beta_0 + \\beta_1 \\times \\textrm{bm}_i + \\beta_2 \\times \\textrm{as}_i + \\beta_3 \\times \\textrm{bm}_i \\times \\textrm{as}_i + \\epsilon_i\n$$\n\\vspace{4cm}\n\n\n## Modellierung\n\n```{r}\n#| echo: true\nmod_3 <- lm(vel ~ body_mass_c * arm_span_c, handball) \n```\n```{r}\nhandball <- handball |> \n  dplyr::mutate(res_3 = resid(mod_3),\n                y_hat_3 = predict(mod_3))\nmod_3 |> lm_tbl_knitr(caption = \"Modell 3\", long = T, add_sigma = T)\n```\n^[`A*B wird von R ausmultipliziert in A + B + A:B`. Hätte auch `lm(vel ~ body_mass_c + arm_span_c + body_mass_c:arm_span_c)` verwenden können.]\n\n## Einfache Steigungen in Vergleich\n\n```{r}\n#| fig.cap: \"Modell ohne Interaktionen\"\n\nhb_new <- tibble::tibble(\n  arm_span_c = rep(c(-5,5),5),\n  body_mass_c = rep(seq(-6,6,by=3), each=2),\n  bm_f = factor(body_mass_c)\n)\nhb_new_1 <- hb_new |> \n  dplyr::mutate(vel = predict(mod_2, newdata = hb_new))\nggplot(hb_new_1, aes(arm_span_c, vel, group=bm_f)) +\n  geom_point() +\n  geom_line(aes(linetype=bm_f)) +\n  scale_linetype_discrete(\"Level von\\nbody mass\\ncentered\", guide = guide_legend(reverse=T)) +\n  scale_x_continuous(\"Armspannweite zentriert[cm]\", breaks = c(-5,0,5)) +\n  labs(y = 'Ballgeschwindigkeit[m/s]') +\n  theme(text = element_text(size=12))\n```\n\n```{r}\n#| fig.cap=\"Modell mit Interaktionen\"\n\nhb_new_2 <- hb_new |>  dplyr::mutate(vel = predict(mod_3, newdata = hb_new))\np_inter_1 <- ggplot(hb_new_2, aes(arm_span_c, vel, group=bm_f)) +\n  geom_point() +\n  geom_line(aes(linetype=bm_f)) +\n  scale_linetype_discrete(\"Level von\\nbody mass\\ncentered\",\n                          guide = guide_legend(reverse=T)) +\n  scale_x_continuous(\"Armspannweite zentriert[cm]\", breaks = c(-5,0,5)) +\n  labs(y = 'Ballgeschwindigkeit[m/s]') +\n  theme(text = element_text(size=12))\nprint(p_inter_1)\n```\n\n\n## Interaktionen sind symmetrisch\n\n```{r}\n#| fig.cap: \"Veränderung mit der Körpergewicht\"\n\nhb_new_3 <- tibble::tibble(\n  arm_span_c = rep(seq(-10,10,by=5), each=2),\n  body_mass_c = rep(c(-.5,.5), 5),\n  arm_f = factor(arm_span_c)\n)\nhb_new_3 <- hb_new_3 |> \n  dplyr::mutate(vel = predict(mod_3, newdata = hb_new_3))\np_inter_2 <- ggplot(hb_new_3, aes(body_mass_c, vel, group=arm_f)) +\n  geom_point() +\n  geom_line(aes(linetype=arm_f)) +\n  scale_linetype_discrete(\"Level von\\narm span\\ncentered\",\n                          guide = guide_legend(reverse=T)) +\n  scale_x_continuous(\"Bodymass zentriert[kg]\", breaks = c(-.5,0,.5)) +\n  labs(y = 'Ballgeschwindigkeit[m/s]') +\n  theme(text = element_text(size=12))\nprint(p_inter_2)\n```\n\n```{r}\n#| fig.cap: \"Veränderung mit dem Armspannweite\"\n\nprint(p_inter_1)\n```\n\n\n## Warum das Model Sinn macht{.t}\n\n```{r}\n#| fig.cap: \"Veränderung mit dem Körpergewicht\"\n\nprint(p_inter_2)\n```\n```{r}\ntbl_simple <- hb_new_3 |>\n  dplyr::filter(arm_span_c %in% c(10,0,-10)) |> \n  dplyr::group_by(arm_span_c) |>\n  dplyr::summarize(b_0 = coef(lm(vel ~ body_mass_c))[1],\n            b_1 = coef(lm(vel ~ body_mass_c))[2],\n            arm_f = arm_f[1]) |> \n  dplyr::select(-1) |> dplyr::relocate(arm_f) |> \n  dplyr::arrange(dplyr::desc(arm_f)) |> \n  knitr::kable(booktabs = T,\n               col.names = c('arm span\\\\\\\\centered',\n                             '$\\\\beta_0$','$\\\\beta_1$'),\n               digits = 2, escape = F,\n               caption = 'Einfache Steigungen')\ntbl_simple\n```\n\n## Warum das Modell Sinn macht{.t}\n\n\\scriptsize\n```{r}\ntbl_simple\n```\n```{r}\nmod_3_cs <- coef(mod_3) \nnames(mod_3_cs) <- c('b0','bm_c','as_c','bm_c:as_c')\nknitr::kable(mod_3_cs, booktabs = T, col.names = 'betas',\n             digits = 2, caption='Modellkoeffizienten', escape=T)\n```\n\n## Interpretation der Koeffizienten\n\n$$\nY = b_0 + b_1 \\cdot x_1 + b_2 \\cdot x_2 + b_3 \\cdot x_1 \\cdot x_2 + \\epsilon_i\n$$\n\n- $b_0$: (y-Achsenabschnitt) der Wert von $\\hat{Y}$ wenn $x_1 = 0$ und $x_2 = 0$ gilt.\n- $b_1$: Der Unterschied in $\\hat{Y}$ wenn zwei Objekte sich in $x_1$ um eine Einheit unterscheiden und $x_2 = 0$ ist.\n- $b_2$: Der Unterschied in $\\hat{Y}$ wenn zwei Objekte sich in $x_2$ um eine Einheit unterscheiden und $x_1 = 0$ ist.\n- $b_3$: (Interaktionskoeffizient) Die Veränderung des Effekts von $x_1$ auf $\\hat{Y}$ wenn $x_2$ um eine Einheit größer wird bzw. genau andersherum für $x_2$.\n\n## Aus der Ebene wird eine gekrümmte Fläche \n\n```{r}\n#| fig.cap: \"3D Streudiagramm des Interaktionsmodells\"\n\npar(mar=c(1,1,1,1), cex.axis = 0.5)\n# x, y, z variables\nx <- handball$body_mass_c\ny <- handball$arm_span_c\nz <- handball$vel\n# Compute the linear regression (z = ax + by + d)\nfit <- lm(z ~ x + y)\n# predict values on regular xy grid\ngrid.lines = 26\nx.pred <- seq(min(x), max(x), length.out = grid.lines)\ny.pred <- seq(min(y), max(y), length.out = grid.lines)\nxy <- expand.grid( body_mass_c = x.pred, arm_span_c = y.pred)\nz.pred <- matrix(predict(mod_3, newdata = xy), \n                 nrow = grid.lines, ncol = grid.lines)\n# fitted points for droplines to surface\nfitpoints <- predict(mod_3)\n# scatter plot with regression plane\nplot3D::scatter3D(x, y, z, col='black', pch=16, cex=1.2,\n    theta = -20, phi = 20, ticktype = \"detailed\",\n    xlab = \"body mass[kg]\", ylab = \"arm span[cm]\", zlab = \"ball velocity[m/s]\",  \n    surf = list(x = x.pred, y = y.pred, z = z.pred,  \n    facets = NA, fit = fitpoints, col='red'), main = \"\", bty=\"b2\",\n    colkey=F, d = 4)\n```\n\n\n## Residuenvergleich\n\n```{r}\n#| fig.cap=\"Residuen im additiven Modell\"\n\nprint(p_resid_2)\n```\n\n```{r}\n#| fig.cap=\"Residuen im Interaktionsmodell\"\n\nggplot(handball, aes(y_hat_3, res_3)) +\n  geom_point() +\n  geom_hline(yintercept = 0, col = 'red', linetype = 'dashed') +\n  labs(x = expression(paste('Vorhergesagte Werte ', hat(y)[i])),\n       y = expression(paste('Residuen ', hat(e)[i]))) \n```\n\n## Residuenvergleich - qq-Plot\n\n```{r}\n#| fig.cap: \"additives Modell\"\n\nggplot(handball, aes(sample = res_2)) +\n  geom_qq() +\n  stat_qq_line() +\n  labs(x = 'Theoretisch', y = 'Empirisch') \n```\n```{r}\n#| fig.cap: \"Interaktionsmodell\"\n\nggplot(handball, aes(sample = res_3)) +\n  geom_qq() +\n  stat_qq_line() +\n  labs(x = 'Theoretisch', y = 'Empirisch') \n```\n\n\n## Take-away{.t}\n\nInteraktionsmodell\n\n- Erhöht die Flexibilität des linearen Modells.\n- Bei Interaktionen hängt der Einfluss der einzelnen Variablen immer von den Werten der anderen Variablen ab. \n- Achtung: Interpretation der einfachen Haupteffekte nicht mehr möglich bzw. sinnvoll!\n\n\n## Zuschlag\nWas passiert im Interaktionsmodell mit den Koeffizienten wenn die $x_{ki}$s zentriert werden?\n\n\\small\n\\begin{align*}\ny_i &= \\beta_0 + \\beta_1 (x_{1i} - \\bar{x}_1) + \\beta_2 (x_{2i} - \\bar{x}_2) + \\beta_3 (x_{1i}-\\bar{x}_1)(x_{2i}-\\bar{x}_2) \\\\\n &= \\beta_0 + \\beta_1 x_{1i} - \\beta_1 \\bar{x}_1 + \\beta_2 x_{2i} - \\beta_2 \\bar{x}_2 + \\beta_3 x_{1i} x_{2i} - \\beta_3 x_{1i} \\bar{x}_2 - \\beta_3 \\bar{x}_1 x_{2i} + \\beta_3 \\bar{x}_1 \\bar{x}_2 \\\\ \n &= \\beta_0 - \\beta_1 \\bar{x}_1 - \\beta_2 \\bar{x}_2 + \\beta_3 \\bar{x}_1 \\bar{x}_2 + \\beta_1 x_{1i}- \\beta_3 \\bar{x}_2 x_{1i} + \\beta_2 x_{2i} - \\beta_3 \\bar{x}_1 x_{2i} + \\beta_3 x_{1i} x_{2i} \\\\\n &= \\underbrace{\\beta_0 - \\beta_1 \\bar{x}_1 - \\beta_2 \\bar{x}_2 + \\beta_3 \\bar{x}_1 \\bar{x}_2}_{\\beta_0} + \\underbrace{(\\beta_1 - \\beta_3 \\bar{x}_2) x_{1i}}_{\\beta_1 x_{1i}} + \\underbrace{(\\beta_2 - \\beta_3 \\bar{x}_1) x_{2i}}_{\\beta_2 x_{2i}} + \\beta_3 x_{1i} x_{2i} \n\\end{align*}\n\n## Zum Nacharbeiten\n\n@kutner2005 [p.306-313]\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":2,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"mlm_interactions.html"},"language":{},"metadata":{"lang":"de","fig-responsive":true,"quarto-version":"1.2.258","bibliography":["bibliography.bib"],"theme":"cosmo","callout-icon":true},"extensions":{"book":{"multiFile":true}}},"pdf":{"execute":{"fig-width":5.5,"fig-height":4,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"xelatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","include-in-header":{"text":"\\usepackage{makeidx,multirow}\n\\makeindex\n"},"include-after-body":{"text":"\\printindex\n"},"output-file":"mlm_interactions.pdf"},"language":{},"metadata":{"block-headings":true,"bibliography":["bibliography.bib"],"documentclass":"scrreprt"},"extensions":{"book":{}}}}}